<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Naruto Monolito - Panel Administrativo</title>
<style>
  body { font-family: Arial; background: #f5f5f5; margin: 20px; }
  h2 { background: #222; color: #fff; padding: 8px; border-radius: 6px; }
  section { background: white; padding: 15px; border-radius: 6px; margin-bottom: 20px; box-shadow: 0 0 5px #aaa; }
  label { display: block; margin-top: 5px; }
  input, select, textarea { width: 100%; margin-bottom: 8px; padding: 5px; }
  button { background: #007bff; color: white; padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; }
  button:hover { background: #0056b3; }
  pre { background: #eee; padding: 10px; border-radius: 6px; overflow-x: auto; }
</style>
</head>
<body>

<h1>Aplicación Monolitica Gestión de Ninjas</h1>

<!-- ================== ALDEAS ================== -->
<section id="aldeas">
  <h2>Aldeas</h2>
  <button onclick="listarAldeas()">Listar Aldeas</button>
  <pre id="listaAldeas"></pre>
</section>

<!-- ================== NINJAS ================== -->
<section id="ninjas">
  <h2>Ninjas</h2>
  <form id="formNinja">
    <label>Nombre:</label>
    <input type="text" id="ninjaNombre" required>

    <label>Rango Ninja:</label>
    <select id="ninjaRango">
      <option value="GENIN">GENIN</option>
      <option value="CHUNIN">CHUNIN</option>
      <option value="JONIN">JONIN</option>
    </select>

    <label>Ataque:</label>
    <input type="number" id="ninjaAtaque" required>

    <label>Defensa:</label>
    <input type="number" id="ninjaDefensa" required>

    <label>Chakra:</label>
    <input type="number" id="ninjaChakra" required>

    <label>Aldea:</label>
    <select id="ninjaAldea"></select>

    <button type="submit">Registrar Ninja</button>
  </form>

  <button onclick="listarNinjas()">Listar Ninjas</button>
  <pre id="listaNinjas"></pre>

  <h3>Asignar Jutsu a Ninja</h3>
  <label>Ninja:</label>
  <select id="ninjaSelect"></select>

  <label>Jutsu:</label>
  <select id="jutsuSelect"></select>

  <button onclick="asignarJutsu()">Asignar</button>
</section>

<!-- ================== JUTSUS ================== -->
<section id="jutsus">
  <h2>Jutsus</h2>
  <form id="formJutsu">
    <label>Nombre:</label>
    <input type="text" id="jutsuNombre" required>

    <label>Tipo:</label>
    <input type="text" id="jutsuTipo" required>

    <label>Daño:</label>
    <input type="number" id="jutsuDanio" required>

    <label>Chakra:</label>
    <input type="number" id="jutsuChakra" required>

    <button type="submit">Registrar Jutsu</button>
  </form>

  <button onclick="listarJutsus()">Listar Jutsus</button>
  <pre id="listaJutsus"></pre>
</section>

<!-- ================== MISIONES ================== -->
<section id="misiones">
  <h2>Misiones</h2>
  <form id="formMision">
    <label>Nombre:</label>
    <input type="text" id="misionNombre" required>

    <label>Descripción:</label>
    <textarea id="misionDescripcion" required></textarea>

    <label>Rango Misión:</label>
    <select id="misionRango">
      <option value="D">D</option>
      <option value="C">C</option>
      <option value="B">B</option>
      <option value="A">A</option>
      <option value="S">S</option>
    </select>

    <label>Recompensa:</label>
    <input type="number" id="misionRecompensa" required>

    <label>Rango Ninja mínimo:</label>
    <select id="misionRangoMin">
      <option value="GENIN">GENIN</option>
      <option value="CHUNIN">CHUNIN</option>
      <option value="JONIN">JONIN</option>
    </select>

    <button type="submit">Registrar Misión</button>
  </form>

  <button onclick="listarMisiones()">Listar Misiones</button>
  <pre id="listaMisiones"></pre>
  
  <h3>Asignar Ninja a Misión</h3>
  <label>Misión:</label>
  <select id="misionSelect"></select>

  <label>Ninja:</label>
  <select id="ninjaSelect"></select>

  <button onclick="asignarNinja()">Asignar</button>

</section>

<!-- ================== REPORTES ================== -->
<section id="reportes">
  <h2>Reportes</h2>
  <button onclick="exportar('txt')">Exportar TXT</button>
  <button onclick="exportar('json')">Exportar JSON</button>
  <button onclick="exportar('xml')">Exportar XML</button>
</section>

<script>
const api = '/api';


// ================== ALDEAS ==================
async function listarAldeas() {
  const res = await fetch(`${api}/aldeas`);
  const data = await res.json();
  document.getElementById('listaAldeas').textContent = JSON.stringify(data, null, 2);
  // Cargar aldeas en select de ninjas
  const sel = document.getElementById('ninjaAldea');
  sel.innerHTML = '';
  data.forEach(a => {
    const opt = document.createElement('option');
    opt.value = a.id;
    opt.textContent = a.nombre + ' (' + a.nacion + ')';
    sel.appendChild(opt);
  });
}

// ================== NINJAS ==================
document.getElementById('formNinja').addEventListener('submit', async e => {
  e.preventDefault();
  const body = {
    nombre: ninjaNombre.value,
    rango: ninjaRango.value,
    ataque: parseInt(ninjaAtaque.value),
    defensa: parseInt(ninjaDefensa.value),
    chakra: parseInt(ninjaChakra.value),
    aldea: { id: parseInt(ninjaAldea.value) }
  };
  await fetch(`${api}/ninjas`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
  listarNinjas();
});

async function listarNinjas() {
  const res = await fetch(`${api}/ninjas`);
  const data = await res.json();
  document.getElementById('listaNinjas').textContent = JSON.stringify(data, null, 2);
  // Actualizar dropdown para asignar jutsus
  const sel = document.getElementById('ninjaSelect');
  sel.innerHTML = '';
  data.forEach(n => {
    const opt = document.createElement('option');
    opt.value = n.id;
    opt.textContent = n.nombre + ' (' + n.rango + ')';
    sel.appendChild(opt);
  });
}

async function asignarJutsu() {
  const ninjaId = ninjaSelect.value;
  const jutsuId = jutsuSelect.value;
  await fetch(`${api}/ninjas/${ninjaId}/asignar-jutsu/${jutsuId}`, { method: 'POST' });
  alert('Jutsu asignado correctamente');
  listarNinjas();
}

async function asignarNinja() {
  const ninjaId = ninjaSelect.value;
  const misionId = misionSelect.value;
  await fetch(`${api}/misiones/{misionId}/asignar/{ninjaId}`, { method: 'POST' });
  alert('Ninja asignado correctamente');
  listarMisiones();
}

// ================== JUTSUS ==================
document.getElementById('formJutsu').addEventListener('submit', async e => {
  e.preventDefault();
  const body = {
    nombre: jutsuNombre.value,
    tipo: jutsuTipo.value,
    danio: parseInt(jutsuDanio.value),
    chakra: parseInt(jutsuChakra.value)
  };
  await fetch(`${api}/jutsus`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
  listarJutsus();
});

async function listarJutsus() {
  const res = await fetch(`${api}/jutsus`);
  const data = await res.json();
  document.getElementById('listaJutsus').textContent = JSON.stringify(data, null, 2);
  // Actualizar dropdown para asignar jutsus
  const sel = document.getElementById('jutsuSelect');
  sel.innerHTML = '';
  data.forEach(j => {
    const opt = document.createElement('option');
    opt.value = j.id;
    opt.textContent = j.nombre + ' (' + j.tipo + ')';
    sel.appendChild(opt);
  });
}

// ================== MISIONES ==================
document.getElementById('formMision').addEventListener('submit', async e => {
  e.preventDefault();
  const body = {
    nombre: misionNombre.value,
    descripcion: misionDescripcion.value,
    rango: misionRango.value,
    recompensa: parseInt(misionRecompensa.value),
    rangoMinimo: misionRangoMin.value
  };
  await fetch(`${api}/misiones`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
  listarMisiones();
});

async function listarMisiones() {
  const res = await fetch(`${api}/misiones`);
  const data = await res.json();
  document.getElementById('listaMisiones').textContent = JSON.stringify(data, null, 2);
  // Actualizar dropdown para asignar ninjas
  const sel = document.getElementById('misionSelect');
  sel.innerHTML = '';
  data.forEach(m => {
    const opt = document.createElement('option');
    opt.value = m.id;
    opt.textContent = m.nombre + ' (' + m.rango + ')';
    sel.appendChild(opt);
  });
}

// ================== REPORTES ==================
function exportar(tipo) {
  window.open(`${api}/reportes/${tipo}`, '_blank');
}

// ================== INICIALIZACIÓN ==================
listarAldeas();
listarJutsus();
listarNinjas();
listarMisiones();
</script>

</body>
</html>
